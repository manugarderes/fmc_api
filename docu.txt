游닍 Documentaci칩n de API - FM Cargo
==================================

游댏 Autenticaci칩n y Cabeceras
----------------------------

La mayor칤a de las rutas est치n protegidas (impl칤cito por el uso de req.user en el BaseController).Todas las peticiones a rutas privadas deben incluir el token JWT en la cabecera.

**Headers Requeridos:**

HTTP

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`Content-Type: application/json  Authorization: Bearer` 

1\. Autenticaci칩n (/api/auth o similar)
---------------------------------------

_Nota: Asumiendo que authController se monta en una ruta base._

### 游릭 Login

**POST** /loginGenera un token JWT para acceder al sistema.

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "username": "admin",    "password": "password123"  }   `

**Respuesta (200 OK):**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "message": "Login exitoso",    "token": "eyJhbGciOiJIUzI1Ni...",    "user": {      "id": "uuid...",      "username": "admin",      "role": "admin",      "created_at": "..."    }  }   `

### 游릭 Registro (P칰blico/Admin)

**POST** /registerCrea un usuario y hashea la contrase침a autom치ticamente.

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "username": "chofer1",    "password": "securePass",    "role": "driver"  }   `

2\. Usuarios (/api/users)
-------------------------

Controlador: users.controller.ts_Nota: Este controlador sobrescribe create y update para hashear contrase침as. No usa created\_by/updated\_by._

### 游댳 Obtener Usuarios

*   **GET** /api/users (Lista todos)
    
*   **GET** /api/users/:id (Obtiene uno)
    

**Respuesta:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "id": "uuid...",    "username": "juan.perez",    "role": "admin",    "created_at": "timestamp",    "updated_at": "timestamp"  }   `

### 游댳 Crear Usuario

**POST** /api/users

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "username": "nuevo.usuario",    "password": "password123", // Se hashear치 autom치ticamente    "role": "admin"    // "created_by" se ignora aqu칤  }   `

### 游댳 Actualizar Usuario

**PUT** /api/users/:id

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "password": "nuevaPassword", // Opcional. Si se env칤a, se re-hashea.    "role": "driver"  }   `

3\. Clientes (/api/customers)
-----------------------------

Controlador: customers.controller.ts_Relaciones: Trae la Zona y los usuarios creador/actualizador._

### 游댳 Estructura de Respuesta (GET)

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "id": "uuid...",    "name": "Juan Perez",    "razon_social": "Transportes SA",    "rut": "12345678-9",    "address": "Calle Falsa 123",    "phone": "+5551234",    "email": "contacto@email.com",    "current_balance": 0,    "created_at": "...",    "zone": { "name": "Zona Norte" }, // Relaci칩n    "creator": { "username": "admin" },    "updater": { "username": "admin" }  }   `

### 游댳 Crear / Actualizar (POST/PUT)

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "name": "Cliente Nuevo",    "razon_social": "Empresa SRL",    "rut": "1111111-1",    "address": "Av. Libertador 100",    "phone": "099123456",    "email": "cliente@test.com",    "zone_id": "uuid-de-la-zona" // FK requerida  }   `

4\. Env칤os (/api/shipments)
---------------------------

Controlador: shipments.controller.ts_Es la entidad central. Trae relaciones anidadas profundas: Sender, Receiver, Drivers, Detalles y Tipos de Paquete._

### 游댳 Estructura de Respuesta (GET)

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "id": "uuid...",    "tracking_number": "TRK-001",    "payment_method": "cash", // o 'account'    "status": "pending",    "total_amount": 1500,    "observations": "Cuidado fr치gil",    "pickup_date": "timestamp",    "delivery_date": null,    // Relaciones    "sender": {         "razon_social": "Cliente A",         "address": "Dir A",         "zone": { "name": "Zona Sur" }     },    "receiver": {         "razon_social": "Cliente B",         "address": "Dir B",         "zone": { "name": "Zona Norte" }     },    "pickup_driver_info": { "username": "chofer1" },    "delivery_driver_info": null,    // Detalles (Items del env칤o)    "shipment_details": [      {        "quantity": 5,        "subtotal": 500,        "package_types": {          "unit_price": 100,          "description": "Caja Peque침a"        }      }    ]  }   `

### 游댳 Crear Env칤o (POST)

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "tracking_number": "TRK-999",    "sender_id": "uuid-cliente-origen",    "receiver_id": "uuid-cliente-destino",    "pickup_driver": "uuid-usuario-chofer", // Opcional    "delivery_driver": "uuid-usuario-chofer", // Opcional    "payment_method": "cash",    "status": "pending",    "total_amount": 1000,    "observations": "Dejar en porter칤a"    // Nota: Los detalles (items) se crean usualmente en /api/shipment-details     // o mediante transacci칩n si el backend lo soportara en un solo paso.     // Con el BaseController actual, se inserta solo la cabecera aqu칤.  }   `

5\. Detalles de Env칤o (/api/shipment-details)
---------------------------------------------

Controlador: shipment-details.controller.ts_Se usa para agregar 칤tems a un env칤o existente._

### 游댳 Crear Detalle (POST)

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "shipment_id": "uuid-del-envio",    "package_type_id": "uuid-tipo-paquete",    "quantity": 10,    "subtotal": 1000  }   `

6\. Zonas (/api/zones)
----------------------

Controlador: zones.controller.ts

### 游댳 Estructura de Respuesta (GET)

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "id": "uuid...",    "name": "Montevideo Centro",    "created_at": "...",    "creator": { "username": "admin" }  }   `

### 游댳 Crear (POST)

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "name": "Zona Este"  }   `

7\. Repartos / Viajes (/api/deliveries)
---------------------------------------

Controlador: deliveries.controller.ts_Representa un viaje de reparto que agrupa varios env칤os. Respuesta muy detallada._

### 游댳 Estructura de Respuesta (GET)

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "id": "uuid...",    "name": "Reparto Matutino Lunes",    "created_at": "...",    "driver": { "username": "chofer_juan" },    // Env칤os asociados a este reparto    "shipments": [      {        "tracking_number": "TRK-001",        "status": "in_transit",        "sender": { "razon_social": "...", "zone": { "name": "..." } },        "receiver": { "razon_social": "...", "zone": { "name": "..." } },        "shipment_details": [ ... ]      }    ]  }   `

### 游댳 Crear (POST)

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "name": "Ruta 5 - Tarde",    "driver_id": "uuid-usuario-chofer"  }   `

8\. Tipos de Paquete (/api/package-types)
-----------------------------------------

Controlador: package-types.controller.ts

### 游댳 Estructura de Respuesta (GET)

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "id": "uuid...",    "description": "Sobre Documentaci칩n",    "unit_price": 50.00,    "is_active": true  }   `

### 游댳 Crear (POST)

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "description": "Pallet Grande",    "unit_price": 1500,    "is_active": true  }   `

9\. Transacciones de Cuenta (/api/account-transactions)
-------------------------------------------------------

Controlador: account-transactions.controller.ts

### 游댳 Estructura de Respuesta (GET)

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "id": "uuid...",    "type": "credit", // o 'debit'    "amount": 500,    "balance_after": 1500,    "created_at": "...",    "shipment": { "tracking_number": "TRK-001" }, // Si est치 asociada a un env칤o    "creator": { "username": "admin" }  }   `

### 游댳 Crear (POST)

**Body:**

JSON

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`   {    "customer_id": "uuid-cliente",    "shipment_id": "uuid-envio", // Opcional    "type": "payment",    "amount": 500,    "balance_after": 1000 // Nota: Idealmente esto se calcula en backend, pero el controller recibe body.  }   `

丘뙖잺 Notas T칠cnicas Generales
---------------------------

1.  **Auditor칤a Autom치tica:**
    
    *   Al hacer POST (Crear), el sistema autom치ticamente asigna created\_by y updated\_by con el ID del usuario del token.
        
    *   Al hacer PUT (Actualizar), el sistema actualiza updated\_by y updated\_at.
        
2.  **Manejo de Errores:**
    
    *   400 Bad Request: Error de validaci칩n o base de datos (ej. FK no existe).
        
    *   401 Unauthorized: Token faltante o inv치lido.
        
    *   404 Not Found: ID no encontrado (en getById).
        
    *   500 Internal Server Error: Fallo inesperado.
        
3.  **Fechas:** Todas las fechas (created\_at, pickup\_date) se manejan en formato ISO 8601 (UTC).